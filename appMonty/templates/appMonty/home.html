
<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        {% load static %}
        <meta charset="utf-8">
        {% comment %} <link rel="stylesheet" type="text/css" href="{% static 'appMonty/style.css' %}"> {% endcomment %}
        <link rel="stylesheet" type="text/css" href="{% static 'appMonty/style.css' %}">
        <title></title>
    </head>
    <body>
        <div id="app">
            {% comment %} {% for item in original %}
                <p>
                    {% if forloop.last %} Original Correct:</p>  <p id="originalRight">{{ item.correct }}</p></p> 
                    <p>Original Wrong<p id="originalWrong">{{ item.wrong}} </p></p>
                    {% endif %}
            {% endfor %}  {% endcomment %}
            <p id="originalRight">Original Correct: [[originalRight ]] Original % [[originalPercentage]]</p>
   
            <p id="originalWrong">Original Wrong: [[originalWrong ]]  </p>

            <div id="gameFace">
                <div id="door1">
                    <p v-on:click='door1'>door</p>
                </div>
                
                <div id="door2">
                        <p v-on:click='door2'>door</p>
                </div>
                
                <div id="door3">
                        <p v-on:click='door3'>door</p>
                </div>
                      {% csrf_token %}
                <button v-on:click="axiosPost">Test</button>
            </div>
        </div>

        <script src="https://unpkg.com/vue@next"></script>

        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script>

            let door1 = document.getElementById('door1')
            let door2 = document.getElementById('door2')
            let door3 = document.getElementById('door3')

            let door1Wins = false
            let door2Wins = false
            let door3Wins = false

            let firstRound = true
            let door = ''

            let winningNum = Math.floor(Math.random() * 3) + 1
            let oneOrTwo = Math.floor(Math.random() * + 2) + 1

            const App = {

                delimiters: ['[[', ']]'],

                data() {
                  return {
                    csrfmiddlewaretoken: '',
                    
                    cat: 'cat',
                    winCount: 0,

                    originalRight: 0,
                    originalWrong: 0,

                    originalPercentage: 0,

                    getList: [],
                    lastOriginal: [],

                    firstDoorClick1: false,
                    secondDoorClick1: false,
                    thirdDoorClick1: false,
                  }
                },

                methods: {
                    door1(){
                        if (firstRound){
                            if (winningNum == 1){
                                this.firstDoorClick1 = true
                                oneOrTwo += 1
                                door = 'door' +oneOrTwo
                                console.log(door)
                                document.getElementById(door).style.visibility = 'hidden'
                                firstRound = false
                            }
                            else if ( winningNum == 2){
                                this.firstDoorClick1 = true
                                document.getElementById('door3').style.visibility = 'hidden'
                                firstRound = false
                            }
                            else if (winningNum == 3){
                                this.firstDoorClick1 = true
                                document.getElementById('door2').style.visibility = 'hidden'
                                firstRound = false
                            }
                        }
                        else{
                            if (winningNum == 1){
                                if (this.firstDoorClick1 == true){
                                    alert('you win')
                                    this.originalRight = this.originalRight + 1
                                    this.axiosPost()
                                    this.resetGame()
                                    this.firstDoorClick1 = false
                                }
                                else{
                                    this.resetGame()
                                }

                            }
                            else{
                                if (this.firstDoorClick1 == true){
                                    alert('you lose')
                                    this.originalWrong = this.originalWrong + 1
                                    this.axiosPost()
                                    this.resetGame()
                                    this.firstDoorClick1 = false
                                }
                                else{
                                    this.resetGame()
                                }
                            }
                        }
                    },
                    door2(){
                        if (firstRound){
                            if (winningNum == 2){
                                if (oneOrTwo == 2){
                                    document.getElementById('door3').style.visibility = 'hidden'
                                    firstRound = false
                                    this.secondDoorClick1 = true
                                }
                                else{
                                    door = 'door' +oneOrTwo
                                    document.getElementById(door).style.visibility = 'hidden'
                                    firstRound = false
                                    this.secondDoorClick1 = true
                                }
                            }
                            else if ( winningNum == 1){
                                document.getElementById('door3').style.visibility = 'hidden'
                                firstRound = false
                                this.secondDoorClick1 = true
                            }
                            else if (winningNum == 3){
                                document.getElementById('door1').style.visibility = 'hidden'
                                firstRound = false
                                this.secondDoorClick1 = true
                            }
                        }
                        else{
                            if (winningNum == 2){
                                if (this.secondDoorClick1 == true) {
                                    alert('you win')
                                    this.originalRight = this.originalRight + 1
                                    this.axiosPost()
                                    this.resetGame()
                                    this.secondDoorClick1 = false
                                }
                                else{
                                    alert('you win (no post yet)')

                                    this.resetGame()
                                }
                                
                            }
                            else{
                                if (this.secondDoorClick1 == true){
                                    alert('you lose')
                                    firstRound = true
                                    this.resetGame()
                                   
                                    this.originalWrong = this.originalWrong + 1
                                    this.axiosPost()
                                    this.resetGame()
                                    this.secondDoorClick1 = false
                                }
                                else{
                                    alert('You lose, (no post yet)')
                                    this.resetGame()
                                }
                            }
                        }
                    },
                    
                    door3(){
                        if (firstRound){ 
                            if (winningNum == 3){
                                door = 'door' +oneOrTwo
                                document.getElementById(door).style.visibility = 'hidden'
                                firstRound = false
                            }
                            else if (winningNum == 2) {
                                document.getElementById('door1').style.visibility = 'hidden'
                                firstRound = false
                            }
                            else  if (winningNum == 1){
                                document.getElementById('door2').style.visibility = 'hidden'
                                firstRound = false
                            }
                        }
                        else{
                            if (winningNum == 3){
                                alert('you win')
                            }
                            else{
                                alert('you lose')
                            }
                        }
                    },

                    oneOrTwo() {
                        return Math.floor(Math.random() * + 2) + 1
                    },
                    
                    winningNum() {
                        return Math.floor(Math.random() * 3) + 1
                    },
                    resetGame() {
                        firstRound = true
                        winningNum = Math.floor(Math.random() * 3) + 1
                        oneOrTwo = Math.floor(Math.random() * + 2) + 1
                        document.getElementById('door1').style.visibility = 'visible'
                        document.getElementById('door2').style.visibility = 'visible'
                        document.getElementById('door3').style.visibility = 'visible'
                    },
                    axiosPost: function() {
                        axios({
                            url: "{% url 'appMonty:frontendpost' %}",
                            method: 'put',
                            data: {
                                changeCorrect: this.originalRight,
                                changedWrong: this.originalWrong,
                            },
                            headers: {
                                'X-CSRFToken': this.csrfmiddlewaretoken
                            }
                          }).then(response => {
                            // console.log(response.data, 'cat')
                            this.getData()
                          })
                      },

                    getData: function() {
                        const myOption = {
                            method: 'GET',
                        };
                        fetch('/get_data', myOption)
                        .then((res) => res.json())
                        .then((res) => {
                            console.log(res.items)
                            this.getList = res.items
                        })
                        .then(() => {
                            // get last item from list and save it
                            let arrLen = this.getList.length - 1
                            this.lastOriginal = this.getList[arrLen]

                            console.log(this.lastOriginal.correct)
                            this.originalRight = this.lastOriginal.correct

                            console.log(this.lastOriginal.wrong)
                            this.originalWrong = this.lastOriginal.wrong
                        })
                        .then(() => {
                            let originalPercentagePre = (this.originalRight / this.originalWrong) * 100
                            this.originalPercentage = originalPercentagePre.toFixed(2)
                        })
                    },

                },
                mounted() {
                    console.log(this.oneOrTwo())
                    console.log(door2Wins, 'd2wins')
                    this.csrfmiddlewaretoken = document.querySelector('input[name="csrfmiddlewaretoken"]').value

                    this.getData()
                }
              } 
              Vue.createApp(App).mount('#app')
        </script>
    </body>
</html>